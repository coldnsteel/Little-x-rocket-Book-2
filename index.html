<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little X and the Dinosaur Dream Machine</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            text-shadow: 0 0 20px #8a2be2;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px #8a2be2; }
            to { text-shadow: 0 0 30px #8a2be2, 0 0 40px #4b0082; }
        }
        .chapter {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8a2be2;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            line-height: 1.8;
        }
        .chapter h2 {
            color: #ff6b9d;
            margin-top: 0;
        }
        .chalkboard-container {
            background: rgba(138, 43, 226, 0.2);
            border: 3px dashed #8a2be2;
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
            position: relative;
        }
        #chalkboard, #glitter-canvas, #build-canvas {
            background: #1a1a2e;
            border: 2px solid #4b0082;
            border-radius: 10px;
            cursor: crosshair;
            display: block;
            margin: 20px auto;
        }
        #glitter-canvas {
            background: linear-gradient(to bottom, #ff6b9d, #8a2be2);
            border-color: #ff6b9d;
        }
        .btn {
            background: linear-gradient(45deg, #8a2be2, #4b0082);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
        }
        .controls, .instruments, .toggle-controls {
            margin-top: 15px;
        }
        .instruments, .toggle-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .story-text {
            font-size: 18px;
            margin: 20px 0;
        }
        .character-speech {
            background: rgba(255, 107, 157, 0.1);
            border-left: 4px solid #ff6b9d;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .guest-chat {
            background: rgba(0, 255, 0, 0.1);
            border-left: 4px solid #00ff00;
            animation: guest-pop 1s ease-out;
        }
        @keyframes guest-pop {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav-buttons {
            text-align: center;
            margin: 30px 0;
        }
        .light-status {
            font-size: 24px;
            margin: 10px;
            transition: all 0.3s;
        }
        .light-green { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
        .light-red { color: #ff0000; text-shadow: 0 0 10px #ff0000; }
        #particles, #launch-particles {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
            z-index: 5;
        }
        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            .chapter { padding: 20px; }
        }
    </style>
</head>
<body>
    <div id="stars-container"></div>
    
    <div class="container">
        <h1>Little X and the Dinosaur Dream Machine</h1>
        <p style="text-align: center; font-size: 1.2em; color: #ff6b9d;">Book 2 of the Little X Adventures</p>
        
        <div class="chapter" id="chapter1">
            <h2>Chapter 1: The Cosmic Chalkboard</h2>
            
            <div class="story-text">
                <p>Little X stepped into Uncle Harold's workshop, still thinking about the amazing adventures with ARIA and the purple rocket. The room was filled with fascinating gadgets and glowing instruments, but one thing caught Little X's eye immediately.</p>
                
                <p>In the corner, a mysterious chalkboard hummed with cosmic energy. Purple and blue gradients swirled across its surface like a miniature galaxy.</p>
                
                <div class="character-speech">
                    <strong>Uncle Harold:</strong> "Ah, you've noticed the Dinosaur Dream Machine! It's a very special 3D chalkboard that brings drawings to life."
                </div>
                
                <p>Little X remembered ARIA's lessons about approaching new technology with wisdom. The chalkboard pulsed gently, almost inviting exploration, but Little X hesitated.</p>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "Is it... safe? What if I draw something wrong?"
                </div>
                
                <div class="character-speech">
                    <strong>Uncle Harold:</strong> "That's a wise question! The machine responds to your creativity and pure intentions. It was built to help children explore their imagination safely. Would you like to try?"
                </div>
                
                <p>Little X nodded slowly, picking up the cosmic chalk that glowed with starlight.</p>
            </div>
            
            <div class="chalkboard-container">
                <h3>Try the Cosmic Chalkboard!</h3>
                <p>Draw a simple dinosaur shape. The lines will glow as you create!</p>
                <canvas id="chalkboard" width="600" height="400"></canvas>
                <div class="controls">
                    <button class="btn" onclick="clearBoard()">Clear Board</button>
                    <button class="btn" onclick="bringToLife()">Bring Drawing to Life!</button>
                    <button class="btn" onclick="saveDrawing()">Save Drawing</button>
                </div>
                <div id="drawing-message" style="margin-top: 15px; color: #ff6b9d; font-weight: bold;"></div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="nextChapter()" style="font-size: 18px; padding: 15px 30px;">
                    Continue to Chapter 2
                </button>
            </div>
        </div>

        <div class="chapter" id="chapter2" style="display: none;">
            <h2>Chapter 2: Raaarrr's Rainbow Roar</h2>
            
            <div class="story-text">
                <p>The lines Little X had drawn began to shimmer and pulse with energy. Suddenly, they lifted off the chalkboard and swirled through the air!</p>
                
                <p>With a mighty <strong>RAAARRR!</strong>, the drawing transformed into a living, breathing dinosaur. But this was no ordinary T-Rex ‚Äì this was Raaarrr, whose scales cycled through every color of the rainbow like a living light show.</p>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Hello, Little X! Thank you for bringing me to life! I'm Raaarrr, and I LOVE making music!"
                </div>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "You can talk! And you're... changing colors!"
                </div>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "That's right! My colors show my feelings. Purple when I'm curious, pink when I'm happy, blue when I'm calm, and rainbow when I'm making music! Want to create a Dino Symphony together?"
                </div>
                
                <p>Little X noticed that Uncle Harold was smiling from the corner of the workshop. The chalkboard responded to pure creative joy, just as he'd said.</p>
                
                <p>Raaarrr bounded over to a collection of glowing instruments that appeared around the room:</p>
            </div>
            
            <div class="chalkboard-container">
                <h3>Help Raaarrr Discover Instruments!</h3>
                <p>Click on Raaarrr to hear him try each instrument</p>
                
                <div style="margin: 20px 0;">
                    <div id="raaarrr-character" onclick="playRaaaarrrSound()" style="font-size: 100px; cursor: pointer; transition: transform 0.3s;">
                        ü¶ñ
                    </div>
                </div>
                
                <div class="instruments">
                    <button class="btn" onclick="selectDinoInstrument('piano')">üéπ Cosmic Piano</button>
                    <button class="btn" onclick="selectDinoInstrument('harp')">ü™ï Star Harp</button>
                    <button class="btn" onclick="selectDinoInstrument('flute')">ü™à Nebula Flute</button>
                    <button class="btn" onclick="selectDinoInstrument('drums')">ü•Å Galaxy Drums</button>
                </div>
                
                <div id="instrument-message" style="margin-top: 15px; color: #ff6b9d; font-weight: bold;"></div>
            </div>
            
            <div class="story-text">
                <p>As Little X and Raaarrr experimented with each instrument, something magical happened. The music they created together formed glowing musical notes that floated through the air, creating swirling patterns of light around the workshop.</p>
                
                <div class="character-speech">
                    <strong>Uncle Harold:</strong> "You two are naturals! The Dinosaur Dream Machine responds to the joy you're creating together. This is exactly what it was built for!"
                </div>
                
                <p>Raaarrr was so excited that he started dancing, his tail swishing to the rhythm. But then...</p>
                
                <p><strong>BOOM!</strong></p>
                
                <p>Raaarrr's enthusiastic stomp shook the entire workshop. The chalkboard flashed with brilliant light, and suddenly everything started to spin!</p>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Oops! I didn't mean to‚Äî"
                </div>
                
                <p>But it was too late. Little X and Raaarrr were pulled into a swirling vortex of color and light...</p>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="saveProgress(2); loadChapter(3)">Continue to Chapter 3</button>
                <button class="btn" onclick="loadChapter(1)">Back to Chapter 1</button>
            </div>
        </div>

        <div class="chapter" id="chapter3" style="display: none;">
            <h2>Chapter 3: Glitch in the Galaxy</h2>
            
            <div class="story-text">
                <p>The vortex spat Little X and Raaarrr out onto a sparkling world of pure glitter! The ground shimmered like a million tiny stars, and the sky swirled with colors that matched Raaarrr's scales. But something was wrong‚Äîthe glitter was glitching, forming dark patches that sucked in the light.</p>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Raaarrr! This is the Glitter Planet, but look‚Äîthose dark glitches are eating the sparkle! We need to fix it with music and drawing!"
                </div>
                
                <p>Little X spotted a wise figure in the distance: Keanu, the cosmic guardian, floating on a cloud of stardust. He waved them over with a gentle smile.</p>
                
                <div class="character-speech">
                    <strong>Keanu:</strong> "Young creators, the glitches come from unbalanced intentions. Use your chalkboard and instruments wisely‚Äîpure joy restores the glitter. But choose your path: Draw to heal, or compose to harmonize?"
                </div>
                
                <p>Raaarrr's scales flickered blue (calm) then purple (curious). Little X felt the weight of the choice‚ÄîARIA's lessons echoed: Technology serves wisdom, not whims.</p>
            </div>
            
            <div class="chalkboard-container">
                <h3>Glitter Quest: Choose Your Path!</h3>
                <p>Draw a healing shape or pick an instrument to harmonize the glitches.</p>
                <div style="position: relative; width: 600px; margin: 20px auto;">
                    <canvas id="glitter-canvas" width="600" height="400"></canvas>
                    <canvas id="particles" width="600" height="400" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
                </div>
                <div class="instruments">
                    <button class="btn" onclick="healWithDraw()">Draw to Heal Glitches</button>
                    <button class="btn" onclick="harmonizeWithMusic()">Compose Harmony</button>
                </div>
                <div id="quest-message" style="margin-top: 15px; color: #ff6b9d; font-weight: bold;"></div>
            </div>
            
            <div class="story-text">
                <p>Whatever Little X chose, the glitches began to fade, revealing the true beauty of the Glitter Planet. Raaarrr danced with joy, his scales exploding in full rainbow as the sparkles returned.</p>
                
                <div class="character-speech">
                    <strong>Keanu:</strong> "Well done! Remember, creation with pure hearts mends any glitch. Now, prepare for the final lesson back home..."
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="saveProgress(3); loadChapter(4)">To Chapter 4</button>
                <button class="btn" onclick="loadChapter(2)">Back to Chapter 2</button>
            </div>
        </div>

        <div class="chapter" id="chapter4" style="display: none;">
            <h2>Chapter 4: The Wisdom of Creation</h2>
            
            <div class="story-text">
                <p>The vortex reversed, pulling Little X and Raaarrr back to Uncle Harold's workshop. Keanu's voice echoed softly: "Creation is a gift‚Äîuse it with pure hearts, and it mends all glitches."</p>
                
                <div class="character-speech guest-chat">
                    <strong>ARIA (Guest Playmate):</strong> "Little X, you've built wonders! But remember, creations like buggies and towers serve joy and wisdom‚Äînot just whims. Let's build one last thing together: A moon base control center!"
                </div>
                
                <div class="character-speech">
                    <strong>Keanu:</strong> "Yes‚Äîdraw with pure hearts. Toggle the lights to 'go' (green) or 'stop' (red), and see how balance launches dreams."
                </div>
                
                <p>Raaarrr nodded, scales flashing rainbow excitement. "Raaarrr! Let's build a moon buggy, radio tower, and control panel‚Äîpush buttons for lights and beeps!" ARIA's hologram flickered in, ready to co-draw.</p>
            </div>
            
            <div class="chalkboard-container">
                <h3>Collab Build: Moon Base Adventure!</h3>
                <p>Draw your buggy/tower/control (wheels, antenna, buttons). Click blocks to place, toggle lights for launch!</p>
                <canvas id="build-canvas" width="600" height="400"></canvas>
                <canvas id="launch-particles" width="600" height="400"></canvas>
                <div class="build-blocks">
                    <button class="btn" onclick="placeBlock('wheel')">üöó Wheel (Buggy)</button>
                    <button class="btn" onclick="placeBlock('antenna')">üì° Antenna (Tower)</button>
                    <button class="btn" onclick="placeBlock('button')">üîò Button (Control)</button>
                </div>
                <div class="controls">
                    <button class="btn" onclick="bringBuildToLife()">Bring Build to Life!</button>
                </div>
                <div class="toggle-controls">
                    <button class="btn" onclick="toggleLight()">Toggle Light (Green/Red)</button>
                    <div id="light-status" class="light-status light-green">üü¢ GO - Ready for Launch!</div>
                </div>
                <div id="build-message" style="margin-top: 15px; color: #ff6b9d; font-weight: bold;"></div>
            </div>
            
            <div class="story-text">
                <p>As the build came alive‚Äîbuggy wheels spinning, tower beeping signals, lights flashing‚ÄîKeanu smiled. "See? Balanced creation lights the way home."</p>
                
                <div class="character-speech guest-chat">
                    <strong>ARIA (Playmate):</strong> "Perfect teamwork! What's next adventure, Little X?"
                </div>
                
                <p>Raaarrr high-fived with his tail. The workshop echoed with laughter and sparkles‚Äîthe Dinosaur Dream Machine ready for more dreams.</p>
                <p><em>The End... Until Book 3: StarSong Symphony!</em></p>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="loadChapter(1)">Restart Adventure</button>
                <button class="btn" onclick="shareBuild()">Share Your Moon Base!</button>
            </div>
        </div>
    </div>

    <script>
        function createStars() {
            const container = document.getElementById('stars-container');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }
        }

        // Global Drawing Setup
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentCanvas = null;
        let currentCtx = null;

        function setupDrawing(canvasId) {
            currentCanvas = document.getElementById(canvasId);
            if (!currentCanvas) return;
            currentCtx = currentCanvas.getContext('2d');

            currentCanvas.addEventListener('mousedown', startDrawing);
            currentCanvas.addEventListener('mousemove', draw);
            currentCanvas.addEventListener('mouseup', stopDrawing);
            currentCanvas.addEventListener('mouseout', stopDrawing);
            currentCanvas.addEventListener('touchstart', handleTouchStart);
            currentCanvas.addEventListener('touchmove', handleTouchMove);
            currentCanvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = currentCanvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = currentCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            currentCtx.strokeStyle = '#8a2be2';
            currentCtx.lineWidth = 3;
            currentCtx.lineCap = 'round';
            currentCtx.shadowBlur = 10;
            currentCtx.shadowColor = '#8a2be2';
            currentCtx.beginPath();
            currentCtx.moveTo(lastX, lastY);
            currentCtx.lineTo(x, y);
            currentCtx.stroke();
            [lastX, lastY] = [x, y];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = currentCanvas.getBoundingClientRect();
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;
            isDrawing = true;
        }

        function handleTouchMove(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = currentCanvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            currentCtx.strokeStyle = '#8a2be2';
            currentCtx.lineWidth = 3;
            currentCtx.lineCap = 'round';
            currentCtx.shadowBlur = 10;
            currentCtx.shadowColor = '#8a2be2';
            currentCtx.beginPath();
            currentCtx.moveTo(lastX, lastY);
            currentCtx.lineTo(x, y);
            currentCtx.stroke();
            [lastX, lastY] = [x, y];
        }

        // Ch. 1 Functions
        function clearBoard() {
            currentCtx.clearRect(0, 0, currentCanvas.width, currentCanvas.height);
            document.getElementById('drawing-message').textContent = '';
        }

        function bringToLife() {
            const message = document.getElementById('drawing-message');
            message.textContent = 'Your drawing glows with cosmic energy! Something magical is about to happen...';
            currentCanvas.style.boxShadow = '0 0 30px #8a2be2, 0 0 50px #ff6b9d';
            setTimeout(() => {
                currentCanvas.style.boxShadow = 'none';
                message.textContent = 'Ready for Chapter 2 to see what happens next!';
            }, 2000);
        }

        function saveDrawing() {
            const message = document.getElementById('drawing-message');
            message.textContent = 'Your cosmic creation has been saved to the eternal memory banks!';
        }

        // Ch. 2 Functions
        let currentDinoInstrument = null;
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function selectDinoInstrument(instrument) {
            initAudio();
            currentDinoInstrument = instrument;
            const messages = {
                piano: "üéπ Raaarrr touches the Cosmic Piano and it sparkles!",
                harp: "ü™ï The Star Harp glows as Raaarrr plucks its strings!",
                flute: "ü™à Raaarrr's breath makes the Nebula Flute sing!",
                drums: "ü•Å Raaarrr taps the Galaxy Drums with his tail!"
            };
            document.getElementById('instrument-message').textContent = messages[instrument];
            const freq = 440;
            playTone(freq, 0.5, instrument);
        }

        function playRaaaarrrSound() {
            if (!currentDinoInstrument) {
                document.getElementById('instrument-message').textContent = "Choose an instrument first!";
                return;
            }
            const raaarrr = document.getElementById('raaarrr-character');
            raaarrr.style.transform = 'scale(1.2) rotate(5deg)';
            initAudio();
            playTone(200 + Math.random() * 200, 0.3, currentDinoInstrument);
            setTimeout(() => {
                raaarrr.style.transform = 'scale(1) rotate(0deg)';
            }, 300);
            document.getElementById('instrument-message').textContent = "RAAARRR! üéµ Musical magic!";
        }

        function playTone(frequency, duration, instrument) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            switch(instrument) {
                case 'piano': oscillator.type = 'triangle'; break;
                case 'harp': oscillator.type = 'sine'; break;
                case 'flute': oscillator.type = 'sine'; break;
                case 'drums': oscillator.type = 'square'; break;
                default: oscillator.type = 'sine';
            }
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // Ch. 3 Functions
        let particlesActive = false;
        let particles = [];
        function initGlitterParticles() {
            if (particlesActive) return;
            particlesActive = true;
            const pCanvas = document.getElementById('particles');
            if (!pCanvas) return;
            const pCtx = pCanvas.getContext('2d');
            particles = [];
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * pCanvas.width,
                    y: Math.random() * pCanvas.height,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    color: `hsl(${Math.random() * 360}, 100%, 70%)`,
                    size: Math.random() * 4 + 2
                });
            }
            function animateParticles() {
                if (!particlesActive) return;
                pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.x < 0 || p.x > pCanvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > pCanvas.height) p.vy *= -1;
                    pCtx.fillStyle = p.color;
                    pCtx.beginPath();
                    pCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    pCtx.fill();
                });
                requestAnimationFrame(animateParticles);
            }
            animateParticles();
        }

        function healWithDraw() {
            const message = document.getElementById('quest-message');
            message.textContent = 'Your drawing heals the glitches! Glitter sparkles return ‚Äì Raaarrr turns pink with joy!';
            const glitterCanvas = document.getElementById('glitter-canvas');
            glitterCanvas.style.boxShadow = '0 0 20px #ff6b9d';
            setTimeout(() => glitterCanvas.style.boxShadow = 'none', 1500);
        }

        function harmonizeWithMusic() {
            initAudio();
            const freqs = [440, 523, 659, 784];
            freqs.forEach((f, i) => setTimeout(() => playTone(f, 0.8, 'harp'), i * 200));
            document.getElementById('quest-message').textContent = 'Harmony restores the galaxy! Raaarrr's scales swirl blue-calm.';
        }

        // Ch. 4 Functions
        let lightOn = true;
        function toggleLight() {
            lightOn = !lightOn;
            const status = document.getElementById('light-status');
            const message = document.getElementById('build-message');
            initAudio();
            if (lightOn) {
                status.innerHTML = 'üü¢ GO - Launch Sequence Active!';
                status.className = 'light-status light-green';
                playTone(523, 0.5, 'sine');
                message.textContent = 'Green light! Buggy rolls, tower signals‚Äîadventure awaits!';
            } else {
                status.innerHTML = 'üî¥ STOP - Safety Check!';
                status.className = 'light-status light-red';
                playTone(392, 0.5, 'square');
                message.textContent = 'Red light! Pause for wisdom‚Äîbalance before build.';
            }
        }

        function bringBuildToLife() {
            const message = document.getElementById('build-message');
            message.textContent = 'Your moon base activates! Particles launch the buggy‚Äîwoosh!';
            const buildCanvas = document.getElementById('build-canvas');
            buildCanvas.style.boxShadow = '0 0 30px #00ff00';
            initLaunchParticles();
            setTimeout(() => buildCanvas.style.boxShadow = 'none', 2000);
        }

        let launchParticles = [];
        function initLaunchParticles() {
            const pCanvas = document.getElementById('launch-particles');
            if (!pCanvas) return;
            const pCtx = pCanvas.getContext('2d');
            launchParticles = [];
            for (let i = 0; i < 30; i++) {
                launchParticles.push({
                    x: pCanvas.width / 2,
                    y: pCanvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 5,
                    color: '#00ff00',
                    size: Math.random() * 3 + 1,
                    life: 100
                });
            }
            function animateLaunch() {
                pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
                launchParticles = launchParticles.filter(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 1;
                    pCtx.fillStyle = p.color;
                    pCtx.beginPath();
                    pCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    pCtx.fill();
                    return p.life > 0;
                });
                if (launchParticles.length > 0) requestAnimationFrame(animateLaunch);
            }
            animateLaunch();
        }

        function shareBuild() {
            const canvasData = document.getElementById('build-canvas').toDataURL();
            const shareText = 'Check my moon base from Little X Book 2! ü¶ñüöÄ';
            if (navigator.share) {
                navigator.share({ title: 'My Dino Build', text: shareText, url: window.location.href });
            } else {
                alert(shareText + '\nCopy URL to share!');
            }
        }

        // Progress
        function saveProgress(chapter) {
            localStorage.setItem('littleXProgress', chapter);
        }

        function loadProgress() {
            const saved = localStorage.getItem('littleXProgress');
            if (saved) loadChapter(parseInt(saved));
        }

        // Navigation
        function loadChapter(chapterNum) {
            particlesActive = false;
            document.querySelectorAll('.chapter').forEach(ch => ch.style.display = 'none');
            document.getElementById('chapter' + chapterNum).style.display = 'block';
            window.scrollTo(0, 0);
            if (chapterNum === 3) {
                setTimeout(initGlitterParticles, 100);
            }
            if (chapterNum === 4) {
                setupDrawing('build-canvas');
                lightOn = true;
            } else if (chapterNum === 1) {
                setupDrawing('chalkboard');
            } else if (chapterNum === 2) {
                // No canvas switch needed
            }
        }

        function nextChapter() {
            saveProgress(1);
            loadChapter(2);
        }

        // Init
        createStars();
        loadProgress();
        console.log('Little X Book 2 Full Arc Live!');
    </script>
</body>
</html>
